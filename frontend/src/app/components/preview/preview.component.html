<div class="preview-container">
  <!-- Validation Results -->
  <div class="card validation-results">
    <h2>üìä Resultados de Validaci√≥n</h2>
    
    <div class="validation-summary">
      <div class="summary-item success">
        <span class="summary-icon">‚úì</span>
        <div>
          <p class="summary-number">{{ validationResult.valid_sheets.length }}</p>
          <p class="summary-label">Hojas V√°lidas</p>
        </div>
      </div>
      
      <div class="summary-item error" *ngIf="validationResult.invalid_sheets.length > 0">
        <span class="summary-icon">‚úó</span>
        <div>
          <p class="summary-number">{{ validationResult.invalid_sheets.length }}</p>
          <p class="summary-label">Hojas con Errores</p>
        </div>
      </div>
      
      <div class="summary-item info">
        <span class="summary-icon">üìÑ</span>
        <div>
          <p class="summary-number">{{ validationResult.total_sheets }}</p>
          <p class="summary-label">Total de Hojas</p>
        </div>
      </div>
    </div>

    <!-- Valid Sheets -->
    <div *ngIf="validationResult.valid_sheets.length > 0" class="sheets-section">
      <h3>‚úÖ Hojas V√°lidas</h3>
      <div class="sheets-list">
        <div 
          *ngFor="let sheet of validationResult.valid_sheets"
          class="sheet-item valid"
          [class.selected]="isSheetSelected(sheet.name)"
          (click)="toggleSheet(sheet.name)">
          <div class="sheet-checkbox">
            <input 
              type="checkbox" 
              [checked]="isSheetSelected(sheet.name)"
              (click)="$event.stopPropagation()">
          </div>
          <div class="sheet-info">
            <p class="sheet-name">{{ sheet.name }}</p>
            <p class="sheet-rows">{{ sheet.rows }} registros</p>
          </div>
          <span class="sheet-status">‚úì</span>
        </div>
      </div>
    </div>

    <!-- Invalid Sheets -->
    <div *ngIf="validationResult.invalid_sheets.length > 0" class="sheets-section">
      <h3>‚ö†Ô∏è Hojas con Errores</h3>
      <div class="sheets-list">
        <div 
          *ngFor="let sheet of validationResult.invalid_sheets"
          class="sheet-item invalid">
          <div class="sheet-info">
            <p class="sheet-name">{{ sheet.name }}</p>
            <p class="sheet-rows">{{ sheet.rows }} registros</p>
          </div>
          <div class="sheet-errors">
            <details>
              <summary>Ver errores ({{ sheet.errors.length }})</summary>
              <ul>
                <li *ngFor="let error of sheet.errors">{{ error }}</li>
              </ul>
            </details>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions-container" *ngIf="validationResult.valid_sheets.length > 0">
    <button 
      class="btn btn-primary"
      [disabled]="selectedSheets.size === 0 || isLoadingPreview"
      (click)="loadPreview()">
      <span *ngIf="!isLoadingPreview">üëÅÔ∏è Previsualizar Datos</span>
      <span *ngIf="isLoadingPreview">Cargando...</span>
    </button>
    
    <button class="btn btn-secondary" (click)="goBack()">
      ‚Üê Volver
    </button>
  </div>

  <!-- Preview Data -->
  <div *ngIf="showPreview" class="card preview-data slide-up">
    <h2>üîç Previsualizaci√≥n de Datos</h2>
    
    <!-- Tabs -->
    <div class="tabs">
      <button 
        *ngFor="let preview of previewData"
        class="tab"
        [class.active]="activeTab === preview.sheet_name"
        (click)="setActiveTab(preview.sheet_name)">
        {{ preview.sheet_name }} ({{ preview.total_rows }})
      </button>
    </div>

    <!-- Table -->
    <div *ngFor="let preview of previewData" [hidden]="activeTab !== preview.sheet_name">
      <div class="preview-info">
        <p>Mostrando primeros {{ preview.data.length }} de {{ preview.total_rows }} registros</p>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Edad</th>
              <th>Sexo</th>
              <th>Cargo</th>
              <th>Sueldo</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of preview.data">
              <td>{{ row.nombre }}</td>
              <td>{{ row.edad }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'badge-info': row.sexo === 'Masculino',
                  'badge-success': row.sexo === 'Femenino',
                  'badge-warning': row.sexo === 'Otro'
                }">
                  {{ row.sexo }}
                </span>
              </td>
              <td>{{ row.cargo }}</td>
              <td class="text-right">${{ row.sueldo | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Import Button -->
    <div class="import-section">
      <button 
        class="btn btn-success btn-lg"
        [disabled]="isImporting"
        (click)="importData()">
        <span *ngIf="!isImporting">üíæ Cargar Datos a la Base de Datos</span>
        <span *ngIf="isImporting">Importando...</span>
      </button>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="importMessage" class="alert alert-success slide-up">
    <span class="alert-icon">‚úÖ</span>
    <span>{{ importMessage }}</span>
  </div>

  <div *ngIf="importError" class="alert alert-error slide-up">
    <span class="alert-icon">‚ö†Ô∏è</span>
    <span>{{ importError }}</span>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isImporting" class="loading-overlay">
    <div class="spinner"></div>
    <p>Importando datos...</p>
  </div>
</div>